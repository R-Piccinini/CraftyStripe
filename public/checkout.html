<!DOCTYPE html>
<html>
<head>
    <title>Checkout</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <section>
    </section>

    <script>
        async function createCheckoutSession(product) {
            const response = await fetch('/create-checkout-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(product),
            });

            if (!response.ok) {
                throw new Error('Failed to create checkout session');
            }

            return await response.json();
        }

        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            const name = params.get('name');
            const price = params.get('price');

            if (!name || !price) {
                console.error('No product data found in URL');
                return null;
            }

            return {
                name,
                price: parseInt(price, 10) // Convert to integer
            };
        }

        async function redirectToCheckout() {
            const product = getQueryParams();

            if (!product) {
                console.error('Failed to get product data');
                return;
            }

            try {
                const sessionData = await createCheckoutSession(product);
                const stripe = Stripe('pk_test_51Pt9vJJv94LvXcbBgdFkY12VlRj4OL4VKCbRObPyz7II0abcpbY7LW9ik4juqHsZ6AzFdztvMOh7V75JSRtRTNTy00fr9BhAd7'); // Replace with your Stripe publishable key
                await stripe.redirectToCheckout({ sessionId: sessionData.id });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        redirectToCheckout();
    </script>
</body>
</html>
